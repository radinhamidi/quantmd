<script src="{{STATIC_URL}}common/js/jquery.js"></script>
<script src="{{STATIC_URL}}common/js/jquery-ui.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}galleria/galleria-1.2.7.min.js"></script>
<link rel="stylesheet" type="text/css" href="{{STATIC_URL}}common/css/theme_orange/jquery-ui.css" />
<script>
	$(document).ready(function() {
		$("#new-case-btn").button({
			icons: {
				primary: "ui-icon-plus"
			}
		});
		$(".btn").button({
			icons: {
				primary: "ui-icon-plus"
			},
			text: false
		});
		$("#diagnosis").submit(function(event) {

		/* stop form from submitting normally */
			event.preventDefault(); 
			
		/* get some values from elements on the page: */
			var $form = $( this ),
				url = $form.attr( 'action' );
				
			$("#ui-tabs-1").hide();
		/* Send the data using post and put the results in a div */
			$.post( url, $form.serialize(),
			function( data ) {
				$("#ui-tabs-1").empty().append($(data));
				$("#ui-tabs-1").fadeIn('fast');
			}
			);
		 });
	});
</script>
<div class="title-text">Diagnose Case</div>
<br />

{% if has_pending_case %}
<div id="case-present">
	<div id="galleria" style="width:256px; height:256px;margin:20px auto">
		{% for iname in image_names %}
        <img src="{{MEDIA_URL}}dicom/{{data.name}}/{{iname}}">
		{% endfor %}
    </div>
    <script>
        Galleria.loadTheme('{{STATIC_URL}}galleria/themes/classic/galleria.classic.min.js');
        Galleria.run('#galleria');
    </script>
	<br /><br />
	<a href="{{MEDIA_URL}}dicom/{{case.data.name}}/{{case.data.name}}.zip">Clike here to download dicom file</a>
	<br /><br />
	<div class="small-title">Diagnosis</div>
	<form id="diagnosis" action="/cardiologist/submit_report/">
		{% csrf_token %}
		<input type="hidden" name="case_id" value="{{case.pk}}" />
		<textarea cols="25" rows="10" name="diagnosis" id="diagnosis"></textarea><br /><br />
		<input type="submit" class="btn" value="Complete" />
	</form>
	<br /><br />
</div>
{% else %}
<div id="case-absent">
	<span class="orange"><a href="/cardiologist/accept_case/" id="new-case-btn" class="orange innerlink">Accept New Case</a></span>
</div><br />
	{% if not messages %}
		No case assigned, please accept one.
	{% endif %}
	{% for message in messages %}
	<div class="span8 offset2">
		<div class="alert {% if message.tags == 'error' %}alert-error{% endif %}">
			{{message}}
		</div>
	</div>
	{% endfor %}
{% endif %}